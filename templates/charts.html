{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-chart-bar"></i> Analytics & Charts</h2>
    <div class="btn-group" role="group">
        <button type="button" class="btn btn-outline-primary active" data-period="monthly">Monthly</button>
        <button type="button" class="btn btn-outline-primary" data-period="weekly">Weekly</button>
        <button type="button" class="btn btn-outline-primary" data-period="daily">Daily</button>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-chart-line"></i> Revenue Trend</h5>
            </div>
            <div class="card-body">
                <canvas id="revenueChart" height="150"></canvas>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-chart-pie"></i> Host Performance</h5>
            </div>
            <div class="card-body">
                <canvas id="hostChart" height="150"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-chart-bar"></i> Viewer Engagement</h5>
            </div>
            <div class="card-body">
                <canvas id="viewerChart" height="150"></canvas>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-chart-area"></i> Growth Metrics</h5>
            </div>
            <div class="card-body">
                <canvas id="growthChart" height="150"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-table"></i> Detailed Host Statistics</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Host</th>
                                <th>Revenue</th>
                                <th>Viewers</th>
                                <th>Hours Streamed</th>
                                <th>Average Rating</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for host in data.top_performers %}
                            <tr>
                                <td><strong>{{ host.name }}</strong></td>
                                <td>${{ "{:,}".format(host.revenue) }}</td>
                                <td>{{ "{:,}".format(host.viewers) }}</td>
                                <td>{{ 120 + loop.index * 15 }}h</td>
                                <td>
                                    <span class="badge bg-success">{{ "%.1f"|format(4.2 + loop.index * 0.2) }}â˜…</span>
                                </td>
                                <td>
                                    <span class="badge bg-success">Active</span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    fetch('/api/chart-data')
        .then(response => response.json())
        .then(data => {
            // Revenue Trend Chart
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: data.revenue_trend.labels,
                    datasets: [{
                        label: 'Revenue ($)',
                        data: data.revenue_trend.data,
                        borderColor: 'rgb(54, 162, 235)',
                        backgroundColor: 'rgba(54, 162, 235, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });

            // Host Performance Chart
            const hostCtx = document.getElementById('hostChart').getContext('2d');
            new Chart(hostCtx, {
                type: 'doughnut',
                data: {
                    labels: data.host_performance.labels,
                    datasets: [{
                        data: data.host_performance.data,
                        backgroundColor: [
                            'rgb(255, 99, 132)',
                            'rgb(54, 162, 235)',
                            'rgb(255, 205, 86)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Viewer Engagement Chart
            const viewerCtx = document.getElementById('viewerChart').getContext('2d');
            new Chart(viewerCtx, {
                type: 'bar',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Daily Viewers',
                        data: [12000, 15000, 18000, 22000, 25000, 28000, 24000],
                        backgroundColor: 'rgba(75, 192, 192, 0.6)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Growth Metrics Chart
            const growthCtx = document.getElementById('growthChart').getContext('2d');
            new Chart(growthCtx, {
                type: 'line',
                data: {
                    labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                    datasets: [{
                        label: 'Host Growth',
                        data: [100, 125, 140, 150],
                        borderColor: 'rgb(255, 99, 132)',
                        backgroundColor: 'rgba(255, 99, 132, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Revenue Growth',
                        data: [80000, 100000, 115000, 125000],
                        borderColor: 'rgb(54, 162, 235)',
                        backgroundColor: 'rgba(54, 162, 235, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false,
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        });
});
</script>
{% endblock %}